<launch>

  <!-- start LaserScan topic for laser_scan_matcher -->
  <!-- (could use raw PointCloud2 data, but need LaserScan later for gmapping/AMCL also) -->
  <include file="$(find nu_jackal_autonav)/launch/pointcloud_to_laserscan.launch" />

  <!-- laser_scan_matcher also needs tf from /base_link to /laser -->
  <!-- <node pkg="tf" type="static_transform_publisher" name="velodyne_to_laser" args="0.0 0.0 0.0 0.0 0.0 0.0 /velodyne /laser 50" /> -->

  <!-- fire up a nodelet manager to handle laser_scan_matcher -->
  <node pkg="nodelet" type="nodelet" name="laser_scan_manager" args="manager" output="screen"/>

  <node pkg="nodelet" type="nodelet" name="laser_scan_matcher" args="load laser_scan_matcher/LaserScanMatcherNodelet laser_scan_manager " output="screen">
    <!-- inputs -->
    <remap from="scan" to="emulated_scan"/>
    <remap from="odom" to="odom_corrected"/>
    <remap from="laser" to="velodyne"/>

    <!-- outputs -->
    <param name="publish_tf" value="false"/> # true causes tf issues
    <param name="publish_pose" value="true"/>
    <remap from="pose2D" to="scan_matcher_pose_estimate"/>
    <!-- <remap from="odom_out" to="/laser_scan_matcher/odom"/> -->

    <!-- motion prediction for faster convergence -->
    <param name="use_imu" value="true"/>
    <param name="use_odom" value="true"/>
    <param name="fixed_frame" value="odom_corrected"/>
    <param name="base_frame" value="base_link"/>

    <!-- KeyFrame params (TL;DR= only update when there's motion) -->
    <param name="kf_dist_linear" value="0.05"/>
    <param name="kf_dist_angular" value="0.1"/>
  </node>

</launch>
